#!/bin/bash

#script para fazer parsing de url e levantar dominios

#Valida se algum argumento foi digitado
if [ $# -ne 1 ]
then
	clear
	echo -e "\033[0035m############################################# \033[m"
	echo -e "\033[0032mBuscando Hosts....\nDesec Security Treinamento- Marcus Oliveira \033[m"
	echo -e "\033[0032m./$0 www.alvo.com.br \033[m"
        echo -e "\033[0035m############################################# \033[m"

else
	echo -e "\033[0035m############################################# \033[m"
	echo -e "\033[0032mBuscando Hosts....\033[m"
        echo -e "\033[0035m############################################# \033[m"
	mkdir $1
	cd $1
	wget  --user-agent="Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.111 Safari/537.36" $1 -o saida-wget.txt
	#regex que valida dominios e endereÃ§os IP
	grep href index.html  | awk -F '/' '{print $3}' | cut -d "'" -f1 | cut -d '"' -f1 | egrep '^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?$|(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}' | sort -u >> lista.txt 
	cat lista.txt
        echo -e "\033[0035m############################################# \033[m"
        echo -e "\033[0032mResolvendo Hosts....\033[m"
        echo -e "\033[0035m############################################# \033[m"
	for dominio in $(egrep '^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?$' lista.txt)
	do
		host $dominio 2> /dev/null | tee -a lista-dominios.txt
	done
fi	
