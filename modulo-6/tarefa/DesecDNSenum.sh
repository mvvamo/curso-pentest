#!/bin/bash

#Script que faz reconhecimento de informacoes por DNS

#DEFININDO variaveis
DOMAIN=$1
LISTA=$2

HELP() {
	echo -e "\033[0035m############################################# \033[m"
        echo -e "\033[0032mDESECDNS RECON...\nDesec Security Treinamento- Marcus Oliveira \033[m"
        echo -e "\033[0032m./$0 www.alvo.com.br wordlist.txt \033[m"
        echo -e "\033[0035m############################################# \033[m"
}

RESOLV_NS() {
	echo -e "\033[0035m############################################# \033[m"
	echo -e "\033[0032mEncontrando Name Servers \033[m"
	echo -e "\033[0035m############################################# \033[m"
	NS_SERVERS=($(host -t ns $DOMAIN 2> /dev/null | awk '{print $NF}' | sort | xargs ))
	echo ${NS_SERVERS[*]}
}

RESOLV_MX()  {
        echo -e "\033[0035m############################################# \033[m"
        echo -e "\033[0032mEncontrando Mail Servers \033[m"
        echo -e "\033[0035m############################################# \033[m"

	host -t mx $DOMAIN 2> /dev/null | awk '{print $NF}'
}

DNS_AXFR() {
	echo -e "\033[0035m############################################# \033[m"
	echo -e "\033[0032mTestando transferir de zona \033[m"
	echo -e "\033[0035m############################################# \033[m"
	
	for NS in "${NS_SERVERS[@]}"
	do
		host -l $DOMAIN $NS 2> /dev/null | grep 'has address'	
	done
}

SUB_DISCOVERY() {
	echo -e "\033[0035m############################################# \033[m"
	echo -e "\033[0032mDescobrindo Subdominios... \033[m"
	echo -e "\033[0035m############################################# \033[m"
	
	for SUB in $(cat $LISTA)
	do
		host $SUB.$DOMAIN 2> /dev/null | grep -v 'not found'
		
	done	

}

if [ $# -ne 2 ]
then
	HELP

else
	RESOLV_NS $DOMAIN
	RESOLV_MX $DOMAIN
	DNS_AXFR  $DOMAIN
	SUB_DISCOVERY $DOMAIN $LISTA
fi
