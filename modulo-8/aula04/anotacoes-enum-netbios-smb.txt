139 - Netbios
445 - SMB

Null Session -> Sessão criada sem autenticação de usuário e senha

IPC$ -> Permite que usuários anonymous executem determinadas atividades




SMB1 – Windows 2000, XP and Windows 2003.
SMB2 – Windows Vista SP1 and Windows 2008
SMB2.1 – Windows 7 and Windows 2008 R2
SMB3 – Windows 8 and Windows 2012. 

Nmap existe o script smb-os-discovery

nmap -v alvo --script=smb-os-discovery


Identificando portas:
nmap -v -p 139,445 -oG smb.txt 'alvo range'

ou
nmap -v --open -sS -Pn -p 139,445 'alvo range' 

Ferramenta mais especilizada para identifcar sbm
nbtscan

Ex:
nbtscan -r 'range com CIDR'

Existe uma ferramenta que extrai informações atraves de sessões nulas do smb (Null session vem por padrão no SMBv1 e pode ser restringido nas outras versoes), enum4linux. Segue um descritivo do autor:
“enum4linux is a tool for enumerating information from
Windows and Samba systems”. It is written in Perl and is basically a wrapper around
the Samba34 tools smbclient, rpcclient, net and nmblookup.

Ex:
enum4linux -a 'Alvo'

O nmap possui muitos scripts de enumeração para visualizar utilize o comando abaixo:
ls -lha /usr/share/nmap/scripts/smb*

Aparecera uma lista com todos scripts de smb do nmap.

Use o smb-os-discovery para dectar o SO através do SMB

nmap -v -p 139,445 --script=smb-os-discovery 'alvo'

Outro script interessante é o que checa vulnerabilidades via smb smb-checkvulns
nmap -v -p 139,445 --script=smb-checkvulns --scriptargs=unsafe=1 'alvo'




